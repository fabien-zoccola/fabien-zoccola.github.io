import t from"./slider-bd50e638.js";import{x as s,W as e,i}from"./index-fe8be053.js";const n={mousemove:"onDragging",touchmove:"onDragging",mouseup:"onDragEnd",touchend:"onDragEnd",contextmenu:"onDragEnd"};function h(t,s,e){return t!=t&&(t=s),t<s&&(t=s),t>e&&(t=e),t}export default class extends t{init(){this.props.min=t=>s(t,0),this.props.max=t=>s(t,100),this.props.step=t=>s(t,1),this.props.value=t=>{null!=t&&this.setValue(s(t,0),!0)},e.prototype.init.apply(this),this.require("active","focus","hover"),this.on("keydown",(t=>{const s=this.step[0]*(t.shiftKey?10:1),e=this.step[1]*(t.shiftKey?10:1);switch(t.key){case"ArrowUp":this.setYValue(this.value[1]+e);break;case"ArrowRight":this.setXValue(this.value[0]+s);break;case"ArrowDown":this.setYValue(this.value[1]-e);break;case"ArrowLeft":this.setYValue(this.value[1]-s);break;default:return}t.preventDefault()}))}connected(){super.connected();const{host:t}=this;this.onDragStart=this.onDragStart.bind(this),this.onDragging=this.onDragging.bind(this),this.onDragEnd=this.onDragEnd.bind(this),t.nuSetContext("disabled",this.disabled),["mousedown","touchstart"].forEach((t=>{this.on(t,this.onDragStart,{passive:!0})}))}changed(t,s){super.changed(t,s),this.isConnected&&["min","max"].includes(t)&&this.setValue(this.value)}onDragStart(t){this.disabled||(this.setValueByEvent(t),this.dragging=!0,Object.entries(n).forEach((([t,s])=>{window.addEventListener(t,this[s],{passive:!0})})))}onDragging(t){this.dragging&&this.setValueByEvent(t)}onDragEnd(t){this.dragging&&(this.dragging=!1,Object.entries(n).forEach((([t,s])=>{window.removeEventListener(t,this[s])})))}setValueByEvent(t){const{host:s}=this,e=s.getBoundingClientRect(),i=(t.pageX||t.touches&&t.touches.length&&t.touches[0].pageX)-window.scrollX,n=Math.max(0,Math.min(1,(i-e.x)/e.width)),h=(t.pageY||t.touches&&t.touches.length&&t.touches[0].pageY)-window.scrollY,a=1-Math.max(0,Math.min(1,(h-e.y)/e.height));this.setXPercents(n),this.setYPercents(a)}setXPercents(t){if(null==t)return;const s=this.min[0],e=this.max[0],i=this.step[0];this.setXValue(Math.round(t*(e-s)/i)*i+s)}setYPercents(t){if(null==t)return;const s=this.min[1],e=this.max[1],i=this.step[1];this.setYValue(Math.round(t*(e-s)/i)*i+s)}setXValue(t){const s=this.value[0];(t=h(t,this.min[0],this.max[0]))!==s&&this.setValue([t,this.value[1]])}setYValue(t){const s=this.value[1];(t=h(t,this.min[1],this.max[1]))!==s&&this.setValue([this.value[0],t])}setValue(t,e){const{host:n}=this;"string"==typeof t&&(t=s(t)),Array.isArray(t)||(t=[this.min[0],this.min[1]]),t=[h(t[0],this.min[0],this.max[0]),h(t[1],this.min[1],this.max[1])],i(t,this.value)||(this.value=t,n.style.setProperty("--local-offset-x",this.getXOffset(t[0])),n.style.setProperty("--local-offset-y",this.getYOffset(t[1])),e||this.emit("input",t),this.control())}getXOffset(t){let s=this.min[0];return`${((t-s)/(this.max[0]-s)*100).toFixed(2)}%`}getYOffset(t){let s=this.min[1];return`${((t-s)/(this.max[1]-s)*100).toFixed(2)}%`}}
